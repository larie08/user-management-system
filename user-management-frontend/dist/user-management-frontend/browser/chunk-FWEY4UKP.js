import{Ba as l,a as n,d as a,f as o,k as u,o as p,r as h,ta as c}from"./chunk-ORHOKJTR.js";var f={production:!1,apiUrl:"http://localhost:4000"};var e=`${f.apiUrl}/accounts`,j=(()=>{class s{constructor(t,i){this.router=t,this.http=i,this.accountSubject=new a(null),this.account=this.accountSubject.asObservable()}get accountValue(){return this.accountSubject.value}login(t,i){return this.http.post(`${e}/authenticate`,{email:t,password:i},{withCredentials:!0}).pipe(o(r=>(this.accountSubject.next(r),this.startRefreshTokenTimer(),r)))}logout(){this.http.post(`${e}/revoke-token`,{},{withCredentials:!0}).subscribe(),this.stopRefreshTokenTimer(),this.accountSubject.next(null),this.router.navigate(["/account/login"])}refreshToken(){return this.http.post(`${e}/refresh-token`,{},{withCredentials:!0}).pipe(o(t=>(this.accountSubject.next(t),this.startRefreshTokenTimer(),t)))}register(t){return this.http.post(`${e}/register`,t)}verifyEmail(t){return this.http.post(`${e}/verify-email`,{token:t})}forgotPassword(t){return this.http.post(`${e}/forgot-password`,{email:t})}validateResetToken(t){return this.http.post(`${e}/validate-reset-token`,{token:t})}resetPassword(t,i,r){return this.http.post(`${e}/reset-password`,{token:t,password:i,confirmPassword:r})}getAll(){return this.http.get(e)}getById(t){return this.http.get(`${e}/${t}`)}create(t){return this.http.post(e,t)}update(t,i){return this.http.put(`${e}/${t}`,i).pipe(o(r=>(r.id===this.accountValue.id&&(r=n(n({},this.accountValue),r),this.accountSubject.next(r)),r)))}delete(t){return this.http.delete(`${e}/${t}`).pipe(u(()=>{t===this.accountValue.id&&this.logout()}))}startRefreshTokenTimer(){let t=JSON.parse(atob(this.accountValue.jwtToken.split(".")[1])),r=new Date(t.exp*1e3).getTime()-Date.now()-60*1e3;this.refreshTokenTimeout=setTimeout(()=>this.refreshToken().subscribe(),r)}stopRefreshTokenTimer(){clearTimeout(this.refreshTokenTimeout)}static{this.\u0275fac=function(i){return new(i||s)(h(l),h(c))}}static{this.\u0275prov=p({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})();export{f as a,j as b};
